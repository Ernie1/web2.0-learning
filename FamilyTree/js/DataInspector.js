"use strict";function Inspector(divid,diagram,options){var mainDiv=document.getElementById(divid);mainDiv.className="inspector";mainDiv.innerHTML="";this._div=mainDiv;this._diagram=diagram;this._inspectedProperties={};this.inspectedObject=null;this.includesOwnProperties=true;this.declaredProperties={};this.inspectsSelection=true;this.propertyModified=null;if(options!==undefined){if(options["includesOwnProperties"]!==undefined){this.includesOwnProperties=options["includesOwnProperties"]}if(options["properties"]!==undefined){this.declaredProperties=options["properties"]}if(options["inspectSelection"]!==undefined){this.inspectsSelection=options["inspectSelection"]}if(options["propertyModified"]!==undefined){this.propertyModified=options["propertyModified"]}}var self=this;diagram.addModelChangedListener(function(e){if(e.isTransactionFinished){self.inspectObject()}});if(this.inspectsSelection){diagram.addDiagramListener("ChangedSelection",function(e){self.inspectObject()})}}Inspector.showIfNode=function(part){return part instanceof go.Node};Inspector.showIfLink=function(part){return part instanceof go.Link};Inspector.showIfGroup=function(part){return part instanceof go.Group};Inspector.showIfPresent=function(data,propname){if(data instanceof go.Part){data=data.data}return typeof data==="object"&&data[propname]!==undefined};Inspector.prototype.inspectObject=function(object){var inspectedObject=object;if(inspectedObject===undefined){if(this.inspectsSelection){inspectedObject=this._diagram.selection.first()}else{inspectedObject=this.inspectedObject}}if(inspectedObject===null||this.inspectedObject===inspectedObject){this.inspectedObject=inspectedObject;this.updateAllHTML();return}this.inspectedObject=inspectedObject;var mainDiv=this._div;mainDiv.innerHTML="";if(inspectedObject===null){return}var data=(inspectedObject instanceof go.Part)?inspectedObject.data:inspectedObject;if(!data){return}var table=document.createElement("table");var tbody=document.createElement("tbody");this._inspectedProperties={};this.tabIndex=0;var declaredProperties=this.declaredProperties;for(var k in declaredProperties){var val=declaredProperties[k];if(!this.canShowProperty(k,val,inspectedObject)){continue}var defaultValue="";if(val.defaultValue!==undefined){defaultValue=val.defaultValue}if(data[k]!==undefined){defaultValue=data[k]}tbody.appendChild(this.buildPropertyRow(k,defaultValue||""))}if(this.includesOwnProperties){for(var k in data){if(k==="__gohashid"){continue}if(this._inspectedProperties[k]){continue}if(declaredProperties[k]&&!this.canShowProperty(k,declaredProperties[k],inspectedObject)){continue}tbody.appendChild(this.buildPropertyRow(k,data[k]))}}table.appendChild(tbody);mainDiv.appendChild(table)};Inspector.prototype.canShowProperty=function(propertyName,propertyDesc,inspectedObject){if(propertyDesc.show===false){return false}if(typeof propertyDesc.show==="function"){return propertyDesc.show(inspectedObject,propertyName)}return true};Inspector.prototype.canEditProperty=function(propertyName,propertyDesc,inspectedObject){if(this._diagram.isReadOnly||this._diagram.isModelReadOnly){return false}var data=(inspectedObject instanceof go.Part)?inspectedObject.data:inspectedObject;var valtype=typeof data[propertyName];if(valtype==="function"){return false}if(propertyDesc){if(propertyDesc.readOnly===true){return false}if(typeof propertyDesc.readOnly==="function"){return !propertyDesc.readOnly(inspectedObject,propertyName)}}return true};Inspector.prototype.buildPropertyRow=function(propertyName,propertyValue){var mainDiv=this._div;var tr=document.createElement("tr");var td1=document.createElement("td");td1.textContent=propertyName;tr.appendChild(td1);var td2=document.createElement("td");var input=document.createElement("input");var decProp=this.declaredProperties[propertyName];input.tabIndex=this.tabIndex++;var self=this;function setprops(){self.updateAllProperties()}input.value=this.convertToString(propertyValue);input.disabled=!this.canEditProperty(propertyName,decProp,this.inspectedObject);if(decProp){var t=decProp.type;if(t!=="string"&&t!=="number"&&t!=="boolean"&&t!=="arrayofnumber"&&t!=="point"&&t!=="size"&&t!=="rect"&&t!=="spot"&&t!=="margin"){input.setAttribute("type",decProp.type)}if(decProp.type==="color"){if(input.type==="color"){input.addEventListener("input",setprops);input.addEventListener("change",setprops);input.value=this.convertToColor(propertyValue)}}}if(input.type!=="color"){input.addEventListener("blur",setprops)}td2.appendChild(input);tr.appendChild(td2);this._inspectedProperties[propertyName]=input;return tr};Inspector.prototype.convertToColor=function(propertyValue){var ctx=document.createElement("canvas").getContext("2d");ctx.fillStyle=propertyValue;return ctx.fillStyle};Inspector.prototype.convertToArrayOfNumber=function(propertyValue){if(propertyValue==="null"){return null}var split=propertyValue.split(" ");var arr=[];for(var i=0;i<split.length;i++){var str=split[i];if(!str){continue}arr.push(parseFloat(str))}return arr};Inspector.prototype.convertToString=function(x){if(x===undefined){return"undefined"}if(x===null){return"null"}if(x instanceof go.Point){return go.Point.stringify(x)}if(x instanceof go.Size){return go.Size.stringify(x)}if(x instanceof go.Rect){return go.Rect.stringify(x)}if(x instanceof go.Spot){return go.Spot.stringify(x)}if(x instanceof go.Margin){return go.Margin.stringify(x)}if(x instanceof go.List){return this.convertToString(x.toArray())}if(Array.isArray(x)){var str="";for(var i=0;i<x.length;i++){if(i>0){str+=" "}var v=x[i];str+=this.convertToString(v)}return str}return x.toString()};Inspector.prototype.updateAllHTML=function(){var inspectedProps=this._inspectedProperties;var diagram=this._diagram;var isPart=this.inspectedObject instanceof go.Part;var data=isPart?this.inspectedObject.data:this.inspectedObject;if(!data){for(var name in inspectedProps){var input=inspectedProps[name];if(input.type==="color"){input.value="#000000"}else{input.value=""}}}else{for(var name in inspectedProps){var input=inspectedProps[name];var propertyValue=data[name];if(input.type==="color"){input.value=this.convertToColor(propertyValue)}else{input.value=this.convertToString(propertyValue)}}}};Inspector.prototype.updateAllProperties=function(){var inspectedProps=this._inspectedProperties;var diagram=this._diagram;var isPart=this.inspectedObject instanceof go.Part;var data=isPart?this.inspectedObject.data:this.inspectedObject;if(!data){return}diagram.startTransaction("set all properties");for(var name in inspectedProps){var value=inspectedProps[name].value;var decProp=this.declaredProperties[name];if(!this.canEditProperty(name,decProp,this.inspectedObject)){continue}var type="";if(decProp!==undefined&&decProp.type!==undefined){type=decProp.type}if(type===""){var oldval=data[name];if(typeof oldval==="boolean"){type="boolean"}else{if(typeof oldval==="number"){type="number"}else{if(oldval instanceof go.Point){type="point"}else{if(oldval instanceof go.Size){type="size"}else{if(oldval instanceof go.Rect){type="rect"}else{if(oldval instanceof go.Spot){type="spot"}else{if(oldval instanceof go.Margin){type="margin"}}}}}}}}switch(type){case"boolean":value=!(value==false||value==="false"||value==="0");break;case"number":value=parseFloat(value);break;case"arrayofnumber":value=this.convertToArrayOfNumber(value);break;case"point":value=go.Point.parse(value);break;case"size":value=go.Size.parse(value);break;case"rect":value=go.Rect.parse(value);break;case"spot":value=go.Spot.parse(value);break;case"margin":value=go.Margin.parse(value);break}inspectedProps[name].value=value;diagram.model.setDataProperty(data,name,value);if(this.propertyModified!==null){this.propertyModified(name,value)}}diagram.commitTransaction("set all properties")};